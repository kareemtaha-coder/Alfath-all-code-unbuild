<div class="quiz-management-container">
  <!-- Header Section -->
  <header class="quiz-header">
    <h1>Quiz Management System</h1>
    <button class="btn btn-add-quiz" (click)="openQuizModal()">
      <i class="fas fa-plus"></i> Add New Quiz
    </button>
  </header>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="skeleton-loader">
      <div class="skeleton-card"></div>
      <div class="skeleton-card"></div>
      <div class="skeleton-card"></div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="quizzes.length === 0 && !isLoading" class="empty-state">
    <img src="assets/images/empty-state.svg" alt="No quizzes found" />
    <p>No quizzes found. Start by adding a new quiz!</p>
  </div>

  <!-- Quiz List -->
  <div *ngIf="!isLoading && quizzes.length > 0" class="quiz-list">
    <div *ngFor="let quiz of filteredQuizzes" class="quiz-item">
      <div class="quiz-item-header">
        <h2>{{ quiz.title }}</h2>
        <div class="quiz-actions">
          <button class="btn btn-edit" (click)="openQuizModal(quiz)">
            <i class="fas fa-edit"></i> Edit
          </button>
          <button
            class="btn btn-delete"
            (click)="openConfirmationModal('quiz', quiz.id)"
          >
            <i class="fas fa-trash"></i> Delete
          </button>
        </div>
      </div>

      <!-- Manage Questions Button -->
      <button class="btn btn-manage-questions" (click)="loadQuizQuestions(quiz)">
        <i class="fas fa-list"></i> Manage Questions
      </button>

      <!-- Questions Section -->
      <div *ngIf="quiz.questions" class="questions-section">
        <h3>Questions</h3>
        <button class="btn btn-add-question" (click)="openQuestionModal(quiz)">
          <i class="fas fa-plus"></i> Add Question
        </button>

        <!-- Empty State for Questions -->
        <div *ngIf="quiz.questions.length === 0" class="empty-state">
          <img src="assets/images/no-questions.svg" alt="No questions found" />
          <p>No questions added yet. Add a question to get started.</p>
        </div>

        <!-- Question List -->
        <div *ngFor="let question of quiz.questions" class="question-item">
          <div class="question-content">
            <p [innerHTML]="question.content"></p>
            <div class="choices-list">
              <div *ngFor="let choice of question.choices" class="choice-item">
                <span class="choice-icon" [class.correct]="choice.isCorrect">
                  <i
                    [class]="
                      choice.isCorrect ? 'fas fa-check-circle' : 'far fa-circle'
                    "
                  ></i>
                </span>
                <span class="choice-text" [innerHTML]="choice.content"></span>
              </div>
            </div>
          </div>
          <div class="question-actions">
            <button
              class="btn btn-edit"
              (click)="openQuestionModal(quiz, question)"
            >
              <i class="fas fa-edit"></i> Edit
            </button>
            <button
              class="btn btn-toggle-status"
              [class.active]="question.isActive"
              (click)="toggleQuestionStatus(quiz, question)"
              [disabled]="loadingStates['question-' + question.id]"
            >
              <i
                *ngIf="!loadingStates['question-' + question.id]"
                class="fas fa-trash"
              ></i>
              <i
                *ngIf="loadingStates['question-' + question.id]"
                class="fas fa-spinner fa-spin"
              ></i>
              {{ question.isActive ? 'Deleted' : 'Delete' }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Quiz Modal -->
  <div *ngIf="isQuizModalOpen" class="modal-overlay">
    <div class="modal-content">
      <h2>{{ editMode ? 'Edit Quiz' : 'Add New Quiz' }}</h2>
      <form [formGroup]="quizForm" (ngSubmit)="submitQuiz()">
        <div class="form-group">
          <label for="quiz-title">Quiz Title</label>
          <input
            id="quiz-title"
            type="text"
            formControlName="title"
            placeholder="Enter quiz title"
          />
          <!-- Client-side Validation -->
          <div
            *ngIf="
              quizForm.get('title')?.invalid && quizForm.get('title')?.touched
            "
            class="error-message"
          >
            Title is required and must be at least 3 characters.
          </div>
        </div>
        <div class="form-group">
          <label for="quiz-title">Number Of Questions</label>
          <input
            id="NumberOfQuestions"
            type="number"
            formControlName="NumberOfQuestions"
            placeholder="Enter Number Of Questions"
          />
          <!-- Client-side Validation -->
          <div
            *ngIf="
              quizForm.get('NumberOfQuestions')?.invalid &&
              quizForm.get('NumberOfQuestions')?.touched
            "
            class="error-message"
          >
            Number Of Questions must be less than 50.
          </div>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn btn-cancel" (click)="closeQuizModal()">
            Cancel
          </button>
          <button
            type="submit"
            class="btn btn-save"
            [disabled]="quizForm.invalid || isSubmitting"
          >
            {{ isSubmitting ? 'Saving...' : 'Save' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Question Modal -->
  <div *ngIf="isQuestionModalOpen" class="modal-overlay">
    <div class="modal-content">
      <h2>{{ editQuestionMode ? 'Edit Question' : 'Add New Question' }}</h2>
      <form [formGroup]="questionForm" (ngSubmit)="submitQuestion()">
        <div class="form-group">
          <label for="question-content">Question</label>
          <quill-editor
            id="question-content"
            formControlName="content"
            [modules]="quillConfig"
            placeholder="Enter question content"
          ></quill-editor>
          <!-- Client-side Validation -->
          <div
            *ngIf="
              questionForm.get('content')?.invalid &&
              questionForm.get('content')?.touched
            "
            class="error-message"
          >
            Question content is required and must be at least 3 characters.
          </div>
        </div>

        <!-- Choices Section -->
        <div formArrayName="choices" class="choices-section">
          <h3>Choices</h3>
          <div
            *ngFor="let choice of choices.controls; let i = index"
            [formGroupName]="i"
            class="choice-item"
          >
            <div class="form-group">
              <label for="question-choices">Enter Choice</label>
              <input
                id="content"
                type="text"
                formControlName="content"
                placeholder="Enter Choice"
              />
            </div>
            <div class="choice-actions">
              <label class="correct-choice-label">
                <input
                  type="radio"
                  [name]="'correct-choice'"
                  [value]="true"
                  [checked]="choice.get('isCorrect')?.value"
                  (change)="setCorrectAnswer(i)"
                />
                Correct Answer
              </label>
              <button
                type="button"
                class="btn btn-remove-choice"
                (click)="removeChoice(i)"
                *ngIf="choices.length > 2"
              >
                <i class="fas fa-times"></i> Remove
              </button>
            </div>
          </div>
          <button
            type="button"
            class="btn btn-add-choice"
            (click)="addChoiceToQuestion()"
          >
            <i class="fas fa-plus"></i> Add Choice
          </button>
        </div>

        <!-- Modal Actions -->
        <div class="modal-actions">
          <button
            type="button"
            class="btn btn-cancel"
            (click)="closeQuestionModal()"
          >
            Cancel
          </button>
          <button
            type="submit"
            class="btn btn-save"
            [disabled]="questionForm.invalid || isSubmitting"
          >
            {{ isSubmitting ? 'Saving...' : 'Save' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Confirmation Modal -->
  <div *ngIf="isConfirmationModalOpen" class="modal-overlay">
    <div class="modal-content">
      <h2>Confirm Deletion</h2>
      <p>Are you sure you want to delete this {{ itemToDelete?.type }}?</p>
      <div class="modal-actions">
        <button type="button" class="btn btn-cancel" (click)="onCancelDelete()">
          Cancel
        </button>
        <button type="button" class="btn btn-confirm" (click)="onConfirmDelete()">
          Confirm
        </button>
      </div>
    </div>
  </div>
</div>