<section class="dashboard-content">
  <!-- Main container with responsive padding -->
  <div class="container-fluid px-4 py-4">
    <!-- Page header with breadcrumbs -->
    <div class="page-header mb-4 d-flex justify-content-between align-items-center">
      <div>
        <h1 class="h3 fw-bold text-primary mb-1">{{ selectedBlogId ? 'Edit Blog' : 'Blog Management' }}</h1>
      </div>
      <button *ngIf="!previewMode" type="button" (click)="togglePreview()" class="btn btn-outline-primary rounded-pill">
        <i class="bi bi-eye me-2"></i>Preview
      </button>
    </div>

    <!-- Card containing form or preview -->
    <div class="card border-0 shadow-sm mb-4 overflow-hidden">
      <!-- Preview Mode -->
      <div *ngIf="previewMode" class="preview-container p-0">
        <!-- Preview Header -->
        <div class="preview-header d-flex justify-content-between align-items-center p-4 border-bottom">
          <div class="d-flex align-items-center">
            <div class="preview-badge bg-primary text-white rounded-pill px-3 py-1 me-3">Preview</div>
            <h2 class="h5 mb-0 fw-bold">{{ blogForm.get("title")?.value || 'Untitled Blog' }}</h2>
          </div>
          <button (click)="togglePreview()" class="btn btn-outline-secondary rounded-pill">
            <i class="bi bi-pencil me-2"></i>Edit
          </button>
        </div>

        <!-- Preview Content -->
        <div class="preview-content p-4">
          <!-- Featured Image -->
          <div *ngIf="imagePreview" class="preview-image-container mb-4 rounded overflow-hidden">
            <img [src]="imagePreview" alt="Blog preview image" class="img-fluid w-100" style="max-height: 400px; object-fit: cover;" />
          </div>

          <!-- Blog Content -->
          <div class="blog-meta mb-3">
            <span class="badge bg-light text-dark me-2">{{ blogForm.get("category")?.value || 'Uncategorized' }}</span>
            <span class="text-muted">{{ blogForm.get("language")?.value || 'English' }}</span>
            <span *ngIf="blogForm.get('writtenBy')?.value" class="ms-2 text-muted">
              <i class="bi bi-person me-1"></i>{{ blogForm.get("writtenBy")?.value }}
            </span>
          </div>

          <h1 class="display-6 fw-bold mb-4">{{ blogForm.get("title")?.value }}</h1>
          <div class="blog-content" [innerHTML]="blogForm.get('content')?.value"></div>

          <!-- Video embed if available -->
          <div *ngIf="blogForm.get('videoUrl')?.value" class="ratio ratio-16x9 mt-4">
            <iframe [src]="blogForm.get('videoUrl')?.value" allowfullscreen></iframe>
          </div>
        </div>
      </div>

      <!-- Edit Mode -->
      <form *ngIf="!previewMode" [formGroup]="blogForm" (ngSubmit)="onSubmit()" class="blog-form">
        <div class="card-body p-0">
          <!-- Tabs for form sections -->
          <ul class="nav nav-tabs nav-fill" id="blogFormTabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active fw-medium" id="basic-tab" data-bs-toggle="tab" data-bs-target="#basic" type="button" role="tab" aria-controls="basic" aria-selected="true">
                <i class="bi bi-info-circle me-2"></i>Basic Info
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link fw-medium" id="content-tab" data-bs-toggle="tab" data-bs-target="#content" type="button" role="tab" aria-controls="content" aria-selected="false">
                <i class="bi bi-file-text me-2"></i>Content
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link fw-medium" id="media-tab" data-bs-toggle="tab" data-bs-target="#media" type="button" role="tab" aria-controls="media" aria-selected="false">
                <i class="bi bi-image me-2"></i>Media
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link fw-medium" id="settings-tab" data-bs-toggle="tab" data-bs-target="#settings" type="button" role="tab" aria-controls="settings" aria-selected="false">
                <i class="bi bi-gear me-2"></i>Settings
              </button>
            </li>
          </ul>

          <div class="tab-content p-4" id="blogFormTabsContent">
            <!-- Basic Info Tab -->
            <div class="tab-pane fade show active" id="basic" role="tabpanel" aria-labelledby="basic-tab">
              <div class="row">
                <div class="col-md-8">
                  <div class="mb-4">
                    <label for="title" class="form-label fw-semibold" aria-required="true">Blog Title</label>
                    <input type="text" formControlName="title" class="form-control form-control-lg" id="title" placeholder="Enter a compelling title"
                      [class.is-invalid]="blogForm.get('title')?.invalid && blogForm.get('title')?.touched" />
                    <div class="form-text d-flex justify-content-between">
                      <span *ngIf="blogForm.get('title')?.hasError('required') && blogForm.get('title')?.touched" class="text-danger">
                        <i class="bi bi-exclamation-circle me-1"></i>Title is required
                      </span>
                      <span [class.text-danger]="characterCounts.title > 90">{{ characterCounts.title }}/100 characters</span>
                    </div>
                  </div>

                  <div class="mb-4">
                    <label for="category" class="form-label fw-semibold">Category</label>
                    <select class="form-select" id="category" formControlName="category"
                      [class.is-invalid]="blogForm.get('category')?.invalid && blogForm.get('category')?.touched">
                      <option value="" disabled>Select a category</option>
                      <option *ngFor="let category of categories" [value]="category">{{ category }}</option>
                    </select>
                    <div *ngIf="blogForm.get('category')?.hasError('required') && blogForm.get('category')?.touched" class="invalid-feedback">
                      Please select a category
                    </div>
                  </div>
                </div>

                <div class="col-md-4">
                  <div class="card bg-light border-0 h-100">
                    <div class="card-body">
                      <h6 class="card-title fw-bold"><i class="bi bi-lightbulb me-2"></i>Tips</h6>
                      <ul class="card-text small mb-0 ps-3">
                        <li>Use clear, concise titles that include keywords</li>
                        <li>Choose the most relevant category for better organization</li>
                        <li>Be specific about what readers will learn</li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Content Tab -->
            <div class="tab-pane fade" id="content" role="tabpanel" aria-labelledby="content-tab">
              <div class="row">
                <div class="col-md-8">
                  <div class="mb-4">
                    <label for="writtenBy" class="form-label fw-semibold">Author</label>
                    <div class="input-group">
                      <span class="input-group-text"><i class="bi bi-person"></i></span>
                      <input type="text" formControlName="writtenBy" class="form-control" id="writtenBy" placeholder="Enter author name" />
                    </div>
                    <div class="form-text text-end">{{ characterCounts.writtenBy }}/50 characters</div>
                  </div>

                  <div class="mb-4">
                    <label for="content" class="form-label fw-semibold">Content</label>
                    <div class="card border-0 shadow-sm">
                      <quill-editor formControlName="content" [modules]="quillModules"
                        [dir]="blogForm.get('language')?.value === 'Arabic' ? 'rtl' : 'ltr'"
                        class="editor-container" id="content">
                      </quill-editor>
                    </div>
                    <div class="form-text d-flex justify-content-between mt-2">
                      <span *ngIf="blogForm.get('content')?.hasError('required') && blogForm.get('content')?.touched" class="text-danger">
                        <i class="bi bi-exclamation-circle me-1"></i>Content is required
                      </span>
                      <span *ngIf="blogForm.get('content')?.hasError('minlength') && blogForm.get('content')?.touched" class="text-danger">
                        <i class="bi bi-exclamation-circle me-1"></i>Content must be at least 100 characters
                      </span>
                      <span>{{ characterCounts.content }} characters</span>
                    </div>
                  </div>
                </div>

                <div class="col-md-4">
                  <div class="card bg-light border-0 mb-4">
                    <div class="card-body">
                      <h6 class="card-title fw-bold"><i class="bi bi-lightbulb me-2"></i>Writing Tips</h6>
                      <ul class="card-text small mb-0 ps-3">
                        <li>Start with a compelling introduction</li>
                        <li>Use subheadings to organize your content</li>
                        <li>Include examples and evidence</li>
                        <li>End with a clear conclusion or call to action</li>
                      </ul>
                    </div>
                  </div>

                  <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white py-3">
                      <h6 class="mb-0 fw-bold">Content Stats</h6>
                    </div>
                    <div class="card-body">
                      <div class="d-flex justify-content-between mb-2">
                        <span class="text-muted">Characters:</span>
                        <span class="fw-medium">{{ characterCounts.content }}</span>
                      </div>
                      <div class="d-flex justify-content-between mb-2">
                        <span class="text-muted">Min required:</span>
                        <span class="fw-medium">100</span>
                      </div>
                      <div class="progress mt-2" style="height: 8px;">
                        <div class="progress-bar bg-success" role="progressbar"
                          [style.width.%]="characterCounts.content > 100 ? 100 : characterCounts.content"
                          aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Media Tab -->
            <div class="tab-pane fade" id="media" role="tabpanel" aria-labelledby="media-tab">
              <div class="row">
                <div class="col-md-8">
                  <div class="mb-4">
                    <label for="image" class="form-label fw-semibold">Featured Image</label>
                    <div class="drop-zone p-5 rounded-3 text-center bg-light border-2"
                      (dragover)="$event.preventDefault()" (drop)="onFileChange($event)">
                      <input type="file" class="form-control d-none" id="image" (change)="onFileChange($event)" accept="image/*" />
                      <i class="bi bi-cloud-arrow-up display-6 mb-3 text-primary d-block"></i>
                      <p class="mb-2">Drag and drop an image here or <label for="image" class="text-primary cursor-pointer">browse files</label></p>
                      <p class="small text-muted mb-0">Supported formats: JPG, PNG, WebP (Max: 5MB)</p>
                    </div>

                    <!-- Upload Progress -->
                    <div *ngIf="uploadProgress > 0 && uploadProgress < 100" class="progress mt-3" style="height: 8px;">
                      <div class="progress-bar bg-primary" role="progressbar" [style.width.%]="uploadProgress"
                        [attr.aria-valuenow]="uploadProgress" aria-valuemin="0" aria-valuemax="100">
                      </div>
                    </div>
                    <p *ngIf="uploadProgress > 0 && uploadProgress < 100" class="small text-center mt-1">Uploading: {{ uploadProgress }}%</p>

                    <!-- Image Preview -->
                    <div *ngIf="imagePreview" class="mt-3 position-relative">
                      <div class="position-absolute top-0 end-0 m-2">
                        <button type="button" class="btn btn-sm btn-light rounded-pill" (click)="imagePreview = null; blogForm.get('image')?.setValue(null)">
                          <i class="bi bi-x-lg"></i>
                        </button>
                      </div>
                      <img [src]="imagePreview" alt="Preview" class="img-fluid rounded shadow-sm" style="max-height: 300px; width: 100%; object-fit: cover;" />
                    </div>
                  </div>

                  <div class="mb-4">
                    <label for="videoUrl" class="form-label fw-semibold">Video URL</label>
                    <div class="input-group">
                      <span class="input-group-text"><i class="bi bi-youtube"></i></span>
                      <input type="url" formControlName="videoUrl" class="form-control" id="videoUrl" placeholder="Enter YouTube URL" />
                    </div>
                    <div *ngIf="blogForm.get('videoUrl')?.hasError('invalidUrl') && blogForm.get('videoUrl')?.touched" class="text-danger small mt-1">
                      <i class="bi bi-exclamation-circle me-1"></i>Please enter a valid YouTube or Vimeo URL
                    </div>
                    <div *ngIf="!blogForm.get('videoUrl')?.hasError('invalidUrl')" class="form-text">
                      Optional: Add a video to complement your written content
                    </div>
                  </div>
                </div>

                <div class="col-md-4">
                  <div class="card bg-light border-0 mb-4">
                    <div class="card-body">
                      <h6 class="card-title fw-bold"><i class="bi bi-lightbulb me-2"></i>Media Tips</h6>
                      <ul class="card-text small mb-0 ps-3">
                        <li>Use high-quality images (at least 1200x630px)</li>
                        <li>Select visually appealing and relevant images</li>
                        <li>Optimize images for web to improve load speed</li>
                        <li>Add alt text in your content for accessibility</li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Settings Tab -->
            <div class="tab-pane fade" id="settings" role="tabpanel" aria-labelledby="settings-tab">
              <div class="row">
                <div class="col-md-8">
                  <div class="mb-4">
                    <label for="language" class="form-label fw-semibold">Language</label>
                    <select class="form-select" id="language" formControlName="language"
                      [class.is-invalid]="blogForm.get('language')?.invalid && blogForm.get('language')?.touched">
                      <option value="" disabled>Select Article Language</option>
                      <option value="English">English</option>
                      <option value="Arabic">Arabic</option>
                    </select>
                    <div class="form-text">
                      The language determines text direction and some formatting options
                    </div>
                  </div>
<!--
                  <div class="mb-4">
                    <label for="brandName" class="form-label fw-semibold">Brand Name</label>
                    <input type="text" formControlName="brandName" class="form-control" id="brandName" />
                  </div> -->

                  <!-- <div class="mb-4">
                    <label class="form-label fw-semibold">Tags</label>
                    <div class="input-group">
                      <input type="text" class="form-control" placeholder="Add a tag and press enter" #tagInput
                        (keydown.enter)="$event.preventDefault(); blogForm.get('tags')?.value.push(tagInput.value); tagInput.value = ''" />
                      <button class="btn btn-outline-primary" type="button"
                        (click)="blogForm.get('tags')?.value.push(tagInput.value); tagInput.value = ''">
                        Add
                      </button>
                    </div>

                    <div class="tag-container mt-2">
                      <span *ngFor="let tag of blogForm.get('tags')?.value; let i = index" class="badge bg-light text-dark me-2 mb-2 py-2 px-3 rounded-pill">
                        {{ tag }}
                        <i class="bi bi-x-circle ms-1 cursor-pointer" (click)="blogForm.get('tags')?.value.splice(i, 1)"></i>
                      </span>
                    </div>
                  </div> -->
                </div>

                <div class="col-md-4">
                  <div class="card bg-light border-0">
                    <div class="card-body">
                      <h6 class="card-title fw-bold"><i class="bi bi-lightbulb me-2"></i>SEO Tips</h6>
                      <ul class="card-text small mb-0 ps-3">
                        <li>Ensure your title contains key search terms</li>
                        <li>Include relevant keywords in your content</li>
                        <li>Use headings (H2, H3) to structure your content</li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Form Actions -->
          <div class="card-footer bg-white p-4 d-flex gap-2 justify-content-between">
            <div>
              <button type="button" class="btn btn-outline-danger" (click)="clearForm()">
                <i class="bi bi-trash me-2"></i>Clear Form
              </button>
            </div>
            <div class="d-flex gap-2">
              <button type="button" class="btn btn-outline-secondary" (click)="resetForm()">
                <i class="bi bi-arrow-counterclockwise me-2"></i>{{ selectedBlogId ? 'Cancel Edit' : 'Reset' }}
              </button>
              <button type="submit" class="btn btn-primary px-4" [disabled]="blogForm.invalid || isLoading">
                <i class="bi" [ngClass]="selectedBlogId ? 'bi-save' : 'bi-plus-lg'"></i>
                <span class="ms-2">{{ selectedBlogId ? 'Update Blog' : 'Publish Blog' }}</span>
              </button>
            </div>
          </div>
        </div>
      </form>
    </div>

    <!-- Blog List -->
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-white py-3 border-0 d-flex justify-content-between align-items-center">
        <h2 class="h5 mb-0 fw-bold">Manage Blogs</h2>
        <div class="input-group" style="max-width: 300px;">
          <input type="text" class="form-control" placeholder="Search blogs..." #searchInput>
          <button class="btn btn-outline-secondary" type="button">
            <i class="bi bi-search"></i>
          </button>
        </div>
      </div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
              <tr>
                <th scope="col" class="ps-4">Title</th>
                <th scope="col">Category</th>
                <th scope="col">Language</th>
                <th scope="col" class="text-center">Date</th>
                <th scope="col" class="text-end pe-4">Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let blog of blogs">
                <td class="ps-4">
                  <div class="d-flex align-items-center">
                    <div class="me-3" *ngIf="blog.imageName" style="width: 40px; height: 40px;">
                      <img [src]="imageUrl+blog.imageName" alt="Blog thumbnail" class="img-fluid rounded" style="width: 40px; height: 40px; object-fit: cover;">
                    </div>
                    <div *ngIf="!blog.imageName" class="me-3 bg-light rounded d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                      <i class="bi bi-file-text text-muted"></i>
                    </div>
                    <div>
                      <h6 class="mb-0">{{ blog.title }}</h6>
                      <small class="text-muted" *ngIf="blog.writtenBy">by {{ blog.writtenBy }}</small>
                    </div>
                  </div>
                </td>
                <td><span class="badge bg-light text-dark">{{ blog.category }}</span></td>
                <td>{{ blog.language }}</td>
                <td class="text-center">
                  <small class="text-muted">{{ blog.createdAt | date:'mediumDate' }}</small>
                </td>
                <td class="text-end pe-4">
                  <div class="btn-group">
                    <button class="btn btn-sm btn-outline-primary" (click)="editBlog(blog.id)">
                      <i class="bi bi-pencil me-1"></i>Edit
                    </button>
                    <button class="btn btn-sm btn-outline-danger" (click)="deleteBlog(blog.id)">
                      <i class="bi bi-trash me-1"></i>Delete
                    </button>
                  </div>
                </td>
              </tr>
              <tr *ngIf="blogs.length === 0">
                <td colspan="5" class="text-center py-5">
                  <div class="py-4">
                    <i class="bi bi-journal-text display-6 text-muted mb-3 d-block"></i>
                    <h5 class="fw-medium">No blogs found</h5>
                    <p class="text-muted">Get started by creating your first blog post</p>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="card-footer bg-white py-3 border-top d-flex justify-content-between align-items-center">
        <div>
          <span class="text-muted">Showing {{ blogs.length }} blogs</span>
        </div>
        <!-- <nav aria-label="Blog pagination">
          <ul class="pagination mb-0">
            <li class="page-item disabled">
              <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Previous</a>
            </li>
            <li class="page-item active"><a class="page-link" href="#">1</a></li>
            <li class="page-item"><a class="page-link" href="#">2</a></li>
            <li class="page-item"><a class="page-link" href="#">3</a></li>
            <li class="page-item">
              <a class="page-link" href="#">Next</a>
            </li>
          </ul>
        </nav> -->
      </div>
    </div>
  </div>

  <!-- Loading Spinner -->
  <!-- <div *ngIf="isLoading" class="loading-overlay">
    <div class="loading-spinner-container">
      <div class="spinner-grow text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-2 mb-0 text-primary fw-medium">Please wait...</p>
    </div>
  </div> -->

  <!-- Notification Toast -->
  <div *ngIf="notification" class="toast-container position-fixed bottom-0 end-0 p-3">
    <div class="toast show" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="toast-header" [ngClass]="{'bg-success text-white': notification.type === 'success', 'bg-danger text-white': notification.type === 'error'}">
        <i class="bi me-2" [ngClass]="{'bi-check-circle-fill': notification.type === 'success', 'bi-exclamation-circle-fill': notification.type === 'error'}"></i>
        <strong class="me-auto">{{ notification.type === 'success' ? 'Success' : 'Error' }}</strong>
        <small>just now</small>
        <button type="button" class="btn-close" (click)="notification = null"></button>
      </div>
      <div class="toast-body">
        {{ notification.message }}
      </div>
    </div>
  </div>
</section>
